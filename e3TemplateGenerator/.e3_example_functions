#!/usr/bin/env bash
#
#  Copyright (c) 2018 - 2019    Jeong Han Lee
#  Copyright (c) 2018 - 2019    European Spallation Source ERIC
#
#  The program is free software: you can redistribute
#  it and/or modify it under the terms of the GNU General Public License
#  as published by the Free Software Foundation, either version 2 of the
#  License, or any newer version.
#
#  This program is distributed in the hope that it will be useful, but WITHOUT
#  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
#  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
#  more details.
#
#  You should have received a copy of the GNU General Public License along with
#  this program. If not, see https://www.gnu.org/licenses/gpl-2.0.txt
#
#
#   author  : Jeong Han Lee
#   email   : jeonghan.lee@gmail.com
#   date    : Friday, September 27 17:34:40 CEST 2019
#   version : 0.2.1


function addExampleSrc
{
    local DEST=${1}
    create_file_from_template "${_TEMPLATE_DIR}/src/sncExample.stt" "${DEST}/sncExample.stt" ""
    create_file_from_template "${_TEMPLATE_DIR}/src/sncExample.dbd" "${DEST}/sncExample.dbd" ""
    create_file_from_template "${_TEMPLATE_DIR}/src/dbSubExample.c" "${DEST}/dbSubExample.c" ""
    create_file_from_template "${_TEMPLATE_DIR}/src/dbSubExample.dbd" "${DEST}/dbSubExample.dbd" ""
    create_file_from_template "${_TEMPLATE_DIR}/src/myexampleHello.c" "${DEST}/myexampleHello.c" ""
    create_file_from_template "${_TEMPLATE_DIR}/src/myexampleHello.dbd" "${DEST}/myexampleHello.dbd" ""
}

function addExampleCmds
{
    local DEST=${1}
    create_file_from_template "${_TEMPLATE_DIR}/cmds/example.cmd" "${DEST}/example.cmd" "_EPICS_MODULE_NAME"
}

function addExampleDb
{
    local DEST=${1}
    # create_file_from_template "${_TEMPLATE_DIR}/db/circle.db" "${DEST}/circle.db" ""
    create_file_from_template "${_TEMPLATE_DIR}/db/dbExample1.db" "${DEST}/dbExample1.db" ""
    create_file_from_template "${_TEMPLATE_DIR}/db/dbExample2.db" "${DEST}/dbExample2.db" ""
    create_file_from_template "${_TEMPLATE_DIR}/db/dbSubExample.db" "${DEST}/dbSubExample.db" ""
 }


function add_local_example_makefile
{
    local mod_name=${1}
    ## Module_name.Makefile

    cat > ${mod_name}.Makefile <<EOF
#
#  Copyright (c) 2018 - 2019  European Spallation Source ERIC
#
#  The program is free software: you can redistribute
#  it and/or modify it under the terms of the GNU General Public License
#  as published by the Free Software Foundation, either version 2 of the
#  License, or any newer version.
#
#  This program is distributed in the hope that it will be useful, but WITHOUT
#  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
#  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
#  more details.
#
#  You should have received a copy of the GNU General Public License along with
#  this program. If not, see https://www.gnu.org/licenses/gpl-2.0.txt
#
# 
# Author  : Jeong Han Lee
# email   : han.lee@esss.se
# Date    : 
# version : 0.0.1 
#

## The following lines are mandatory, please don't change them.
where_am_I := \$(dir \$(abspath \$(lastword \$(MAKEFILE_LIST))))
include \$(E3_REQUIRE_TOOLS)/driver.makefile
include \$(E3_REQUIRE_CONFIG)/DECOUPLE_FLAGS


ifneq (\$(strip \$(SEQUENCER_DEP_VERSION)),)
sequencer_VERSION=\$(SEQUENCER_DEP_VERSION)
endif

## Exclude linux-ppc64e6500 and linux-corei7-poky
EXCLUDE_ARCHS = linux-ppc64e6500
EXCLUDE_ARCHS += linux-corei7-poky

APP:=${mod_name}App
APPDB:=\$(APP)/Db
APPSRC:=\$(APP)/src

USR_INCLUDES += -I\$(where_am_I)\$(APPSRC)

TEMPLATES += \$(wildcard \$(APPDB)/*.db)
TEMPLATES += \$(wildcard \$(APPDB)/*.template)

SOURCES += \$(APPSRC)/dbSubExample.c
SOURCES += \$(APPSRC)/myexampleHello.c
SOURCES += \$(APPSRC)/sncExample.stt

DBDS    += \$(APPSRC)/dbSubExample.dbd
DBDS    += \$(APPSRC)/myexampleHello.dbd
DBDS    += \$(APPSRC)/sncExample.dbd


db: 

.PHONY: db 

vlibs:

.PHONY: vlibs


EOF
    
}

